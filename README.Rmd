---
title: "owidR"
output: github_document
always_allow_html: true
---

```{r, echo = FALSE, message=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "##",
  fig.path = "inst/images/", fig.width=8.5, fig.asp=0.55, fig.align='center',
  message = FALSE
)

library(dplyr)
```

<!-- badges: start -->
![CRAN downloads](http://cranlogs.r-pkg.org/badges/grand-total/owidR)
[![CRAN status](https://www.r-pkg.org/badges/version/owidR)](https://CRAN.R-project.org/package=owidR)
[![R-CMD-check](https://github.com/piersyork/owidR/workflows/R-CMD-check/badge.svg)](https://github.com/piersyork/owidR/actions)
<!-- badges: end -->

*WARNING:* Due to a change in the Our World in Data Website, owidR will not currently work. Download the development version for a temporary fix (which will only be able to import data that has just one value column). A full fix and CRAN update will follow soon, there will be no syntax changes.

This package acts as an interface to [Our World in Data](https://ourworldindata.org/) datasets, allowing for an easy way to search through data used in over 3,000 charts and load them into the R environment.

## Installation
To install from CRAN:
```{r eval=FALSE}
install.packages("owidR")
```

To install the development version from GitHub: 
``` {r eval = FALSE}
devtools::install_github("piersyork/owidR")
```

## Using the package
The main function in owidR is `owid()`, which takes a chart id and returns a tibble (dataframe) of the corresponding OWID dataset. To search for chart ids you can use `owid_search()` to list all the chart ids that match a keyword or regular expression.

## Example
Lets use the core functions to get data on how human rights have changed over time. First by searching for charts on human rights.
  
``` {r example, eval = TRUE, message = FALSE}
library(owidR)

owid_search("human rights")

```

Let's use the human rights scores dataset.

``` {r example2, eval = TRUE, message = FALSE}

rights <- owid("human-rights-scores")

rights

```


`owid_plot()` makes it easy to visualise an owid dataset, plotting the first value column of an owid dataset. By default the mean score across all countries is plotted.
```{r owid_plot, eval = TRUE, results='hide'}
owid_plot(rights)
```

Use `summarise = FALSE` to show individual countries instead of the mean score. Unless a vector of entities is specified using the `filter` argument 9 random entities will be plotted. If the data is not a time-series then a bar chart of the entities values will be plotted.
```{r owid_plot2, eval = TRUE, results='hide'}
owid_plot(rights, summarise = FALSE, filter = c("North Korea", "South Korea", "France", "United Kingdom", "United States"))
```

`owid_map()` makes it easy to create a choropleth world map of datasets that contain country level data. The Entities of the owid data must be country names. By default the most recent year will be plotted, use the `year` argument to plot a different year.
```{r map, results='hide'}
owid_map(rights)
```

## COVID-19 Data
You can quickly download world covid-19 data, including vaccination rates, using `owid_covid()`. 

```{r covid}
covid <- owid_covid()

covid
```

## To-do
* [ ] Add function to load multiple country datasets into on dataframe
* [ ] Add caching of data (inc. backend)
* [ ] Remove interactive plotting to reduce dependencies
* [ ] Plan/think of way to import owid explorers



